---
sidebar: sidebar 
permalink: concept_nw_vsphere_vswitch_config.html 
keywords: ontap select, standard and distributed vSwitch configurations, vSwitch configuration and load-balancing policies 
summary: 'ONTAP Select vSwitch : stratégies de configuration et d"équilibrage de la charge pour les configurations à deux cartes réseau et à quatre cartes NIC.' 
---
= Configuration ONTAP Select VMware vSphere vSwitch sur ESXi
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP Select vSwitch : stratégies de configuration et d'équilibrage de la charge pour les configurations à deux cartes réseau et à quatre cartes NIC.

ONTAP Select prend en charge l'utilisation des configurations vSwitch standard et distribuées. Les vSwitches distribués prennent en charge les constructions d'agrégation de liens (LACP). L'agrégation de liens est une construction réseau courante utilisée pour agréger la bande passante sur plusieurs adaptateurs physiques. LACP est une norme indépendante des fournisseurs. Il fournit un protocole ouvert pour les points de terminaison de réseau qui regroupent des ports réseau physiques en un seul canal logique. ONTAP Select peut fonctionner avec des groupes de ports configurés en tant que groupe d'agrégation de liens (LAG). Toutefois, NetApp recommande d'utiliser les ports physiques individuels comme de simples ports de liaison montante (trunk) pour éviter la configuration LAG. Dans ces cas, les bonnes pratiques pour les vSwitches standard et distribués sont identiques.

Cette section décrit la configuration vSwitch et les stratégies d'équilibrage de charge à utiliser dans les configurations à deux cartes réseau et à quatre cartes NIC.

Lorsque vous configurez les groupes de ports pour ONTAP Select, suivez ces bonnes pratiques ; la politique d’équilibrage de charge au niveau du groupe de ports est « Route basée sur l’ID du port virtuel d’origine ». VMware recommande de configurer le protocole STP sur Portfast sur les ports du commutateur connectés aux hôtes ESXi.

Toutes les configurations vSwitch nécessitent un minimum de deux adaptateurs réseau physiques regroupés en une seule équipe NIC. ONTAP Select prend en charge une seule liaison de 10 Gb pour les clusters à deux nœuds. Toutefois, NetApp recommande d'utiliser l'agrégation de cartes réseau pour garantir la redondance matérielle.

Sur un serveur vSphere, les équipes NIC sont la construction d'agrégation utilisée pour regrouper plusieurs cartes réseau physiques en un seul canal logique, ce qui permet de partager la charge du réseau entre tous les ports membres. Il est important de se rappeler que les équipes NIC peuvent être créées sans le support du commutateur physique. Les stratégies d'équilibrage de charge et de basculement peuvent être appliquées directement à une équipe NIC, qui ne connaît pas la configuration de commutateur en amont. Dans ce cas, les stratégies sont uniquement appliquées au trafic sortant.


NOTE: Les canaux de ports statiques ne sont pas pris en charge avec ONTAP Select. Les canaux compatibles LACP sont pris en charge avec les vSwitches distribués, mais l'utilisation de LAG LACP peut entraîner une répartition inégale de la charge entre les membres du LAG.

Pour les clusters à nœud unique, ONTAP Deploy configure la machine virtuelle ONTAP Select pour utiliser un groupe de ports pour le réseau externe et soit le même groupe de ports, soit, en option, un groupe de ports différent pour le trafic de gestion du cluster et des nœuds. Pour les clusters à nœud unique, vous pouvez ajouter le nombre souhaité de ports physiques au groupe de ports externes en tant qu'adaptateurs actifs.

Pour les clusters à plusieurs nœuds, ONTAP Deploy configure chaque serveur virtuel ONTAP Select afin qu'il utilise un ou deux groupes de ports pour le réseau interne et, séparément, un ou deux groupes de ports pour le réseau externe. Le trafic de gestion du cluster et des nœuds peut utiliser le même groupe de ports que le trafic externe, ou un autre groupe de ports. Le trafic cluster et node management ne peut pas partager le même port group avec le trafic interne.


NOTE: ONTAP Select prend en charge un maximum de quatre vmnics.



== VSwitch standard ou distribué et quatre ports physiques par nœud

Vous pouvez attribuer quatre groupes de ports à chaque nœud d'un cluster multinœud. Chaque groupe de ports possède un seul port physique actif et trois ports physiques de secours, comme illustré dans la figure suivante.

*VSwitch avec quatre ports physiques par nœud*

image:DDN_08.jpg["VSwitch avec quatre ports physiques par nœud"]

L'ordre des ports dans la liste de secours est important. Le tableau suivant fournit un exemple de distribution physique des ports entre les quatre groupes de ports.

*Configurations minimales et recommandées pour le réseau*

[cols="5*"]
|===
| Groupes de ports | Externe 1 | Externe 2 | Interne 1 | Interne 2 


| Actif | vmnic0 | vmnic1 | vmnic2 | vmnic3 


| Veille 1 | vmnic1 | vmnic0 | vmnic3 | vmnic2 


| Veille 2 | vmnic2 | vmnic3 | vmnic0 | vmnic1 


| Veille 3 | vmnic3 | vmnic2 | vmnic1 | vmnic0 
|===
Les figures suivantes montrent les configurations des groupes de ports réseau externes à partir de l'interface utilisateur vCenter (ONTAP-External et ONTAP-External2). Notez que les adaptateurs actifs proviennent de cartes réseau différentes. Dans cette configuration, vmnic 4 et vmnic 5 sont des ports doubles sur la même carte réseau physique, tandis que vmnic 6 et vminc 7 sont également des ports doubles sur une carte réseau distincte (les vnmic 0 à 3 ne sont pas utilisés dans cet exemple). L'ordre des adaptateurs de secours permet un basculement hiérarchique, les ports du réseau interne étant les derniers. L'ordre des ports internes dans la liste de secours est également inversé entre les deux groupes de ports externes.

*Partie 1 : configurations de groupes de ports externes ONTAP Select*

image:DDN_09.jpg["Partie 1 : configurations de groupes de ports externes ONTAP Select"]

*Partie 2 : configurations de groupes de ports externes ONTAP Select*

image:DDN_10.jpg["Partie 2 : configurations de groupes de ports externes ONTAP Select"]

Pour la lisibilité, les affectations sont les suivantes :

[cols="2*"]
|===
| ONTAP-externe | ONTAP-External2 


| Adaptateurs actifs : vmnic5 Standby : vmnic7, vmnic4, vmnic6 | Adaptateurs actifs : vmnic7 Standby : vmnic5, vmnic6, vmnic4 
|===
Les figures suivantes montrent les configurations des groupes de ports réseau internes (ONTAP-interne et ONTAP-Internal2). Notez que les cartes actives proviennent de différentes cartes réseau. Dans cette installation, vmnic 4 et vmnic 5 sont deux ports sur le même ASIC physique, tandis que vmnic 6 et vmnic 7 sont de même des ports doubles sur un ASIC séparé. L'ordre des cartes de secours fournit un basculement hiérarchique avec les ports du réseau externe en dernier. L'ordre des ports externes dans la liste de secours est également intervertie entre les deux groupes de ports internes.

*Partie 1 : configurations de groupes de ports internes ONTAP Select*

image:DDN_11.jpg["Partie 1 : configurations de groupes de ports internes ONTAP Select"]

*Partie 2 : groupes de ports internes ONTAP Select*

image:DDN_12.jpg["Partie 2 : groupes de ports internes ONTAP Select"]

Pour la lisibilité, les affectations sont les suivantes :

[cols="2*"]
|===
| Interne ONTAP | ONTAP-Internal2 


| Adaptateurs actifs : vmnic4 Standby : vmnic6, vmnic5, vmnic7 | Adaptateurs actifs : vmnic6 Standby : vmnic4, vmnic7, vmnic5 
|===


== VSwitch standard ou distribué et deux ports physiques par nœud

Lors de l'utilisation de deux cartes réseau haut débit (25/40 Gb), la configuration de groupe de ports recommandée est conceptuellement très similaire à la configuration avec quatre adaptateurs 10 Gb. Vous devriez utiliser quatre groupes de ports même si vous n'utilisez que deux adaptateurs physiques. La répartition des groupes de ports est la suivante :

[cols="5*"]
|===
| Groupes de ports | Externe 1 (e0a, e0b) | Interne 1 (e0c,e0e) | Interne 2 (e0d,e0f) | Externe 2 (e0g) 


| Actif | vmnic0 | vmnic0 | vmnic1 | vmnic1 


| Veille | vmnic1 | vmnic1 | vmnic0 | vmnic0 
|===
*VSwitch avec deux ports physiques haut débit (25 Go) par nœud*

image:DDN_17.jpg["VSwitch avec deux ports physiques haut débit (25 Go) par nœud"]

Lorsque vous utilisez deux ports physiques (10 Go ou moins), chaque port group doit disposer d'un adaptateur actif et d'un adaptateur de secours configuré l'un en face de l'autre. Le réseau interne n'est présent que pour les clusters ONTAP Select à plusieurs nœuds. Dans le cas des clusters à un seul nœud, les deux adaptateurs peuvent être configurés comme actifs dans le port group externe.

L'exemple suivant illustre la configuration d'un vSwitch et des deux groupes de ports chargés de gérer les services de communication internes et externes pour un cluster ONTAP Select multinœud. En cas de panne de réseau, le réseau externe peut utiliser la VMNIC du réseau interne car les VMNIC du réseau interne font partie de ce groupe de ports et sont configurées en mode veille. C'est l'inverse pour le réseau externe. L'alternance des VMNIC actives et de secours entre les deux groupes de ports est essentielle pour le bon basculement des VM ONTAP Select lors des pannes de réseau.

*VSwitch avec deux ports physiques (10 Go ou moins) par nœud*

image:DDN_13.jpg["VSwitch avec deux ports physiques par nœud"]



== VSwitch distribué avec LACP

Lorsque vous utilisez des vswitches distribués dans votre configuration, vous pouvez utiliser LACP (bien qu'il ne s'agisse pas d'une meilleure pratique) pour simplifier la configuration du réseau. La seule configuration LACP prise en charge exige que tous les vmnics se trouvent dans un seul LAG. Le commutateur physique uplink doit prendre en charge une taille MTU comprise entre 7,500 et 9,000 sur tous les ports du canal. Les réseaux ONTAP Select internes et externes doivent être isolés au niveau du port group. Le réseau interne doit utiliser un VLAN non routable (isolé). Le réseau externe peut utiliser VST, est ou VGT.

Les exemples suivants montrent la configuration vSwitch distribuée à l'aide de LACP.

*Propriétés LAG lors de l'utilisation de LACP*

image:DDN_14.jpg["Propriétés DE DÉCALAGE lors de l'utilisation de LACP"]

*Configurations de groupes de ports externes utilisant un vSwitch distribué avec LACP activé*

image:DDN_15.jpg["Configurations de groupes de ports externes utilisant un vSwitch distribué avec LACP activé"]

*Configurations de groupes de ports internes utilisant un vSwitch distribué avec LACP activé*

image:DDN_16.jpg["Configurations de groupes de ports internes à l'aide d'un vSwitch distribué avec LACP activé"]


NOTE: LACP nécessite la configuration des ports du commutateur en amont en tant que canal de ports. Avant d'activer cette configuration sur le vSwitch distribué, assurez-vous qu'un canal de port compatible LACP est correctement configuré.
